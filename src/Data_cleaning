import pandas as pd
import os


def load_data(path):
    if not os.path.exists(path):
        raise FileNotFoundError(f"Data file not found at: {path}")

    df = pd.read_csv(path, encoding="utf-8")
    print("Dataset loaded successfully!\n")
    return df


def process_df(df):
    # Display basic information
    print("First 5 rows of the dataset:")
    print(df.head())

    print("\nDataset structure:")
    df.info()

    # HANDLE MISSING VALUES
    print("\n========== HANDLING MISSING VALUES ==========")

    # Fill missing numeric values with 0
    numeric_cols = df.select_dtypes(include=["number"]).columns
    df[numeric_cols] = df[numeric_cols].fillna(0)

    # Fill missing text values with "Unknown"
    text_cols = df.select_dtypes(include=["object"]).columns
    df[text_cols] = df[text_cols].fillna("Unknown")

    print("Missing values handled correctly.")
    print("\nRemaining missing values per column:")
    print(df.isna().sum())

    # REMOVE DUPLICATE ROWS
    print("\n========== REMOVING DUPLICATES ==========")

    rows_before = len(df)
    df.drop_duplicates(inplace=True)
    rows_after = len(df)

    print(f"Duplicates removed: {rows_before - rows_after}")
    print(f"Current dataset size: {rows_after}")

    # CLEAN TEXT COLUMNS
    print("\n========== CLEANING TEXT COLUMNS ==========")

    for col in text_cols:
        df[col] = df[col].astype(str).str.strip()

    print("Text columns cleaned successfully.")

    # FINAL VALIDATION
    print("\n========== FINAL DATA CHECK ==========")
    print("Final dataset info:")
    df.info()

    return df


def save_df(df, out_path):
    out_dir = os.path.dirname(out_path)
    if out_dir and not os.path.exists(out_dir):
        os.makedirs(out_dir)
    
    df.to_csv(out_path, index=False, encoding="utf-8")
    print(f"Cleaned dataset saved as '{out_path}'")


def main():
    # Simple hardcoded paths - change these as needed
    data_path = "Data/Data.csv"
    output_path = "Data/cleaned_data.csv"

    try:
        df = load_data(data_path)
    except FileNotFoundError as e:
        print(f"ERROR: {e}")
        return

    df_clean = process_df(df)
    save_df(df_clean, output_path)

    print("\n========== CLEANING COMPLETED SUCCESSFULLY ==========")


if __name__ == "__main__":
    main()